# ğŸ¨ DIAGRAMA: MULTI-TENANCY - ISOLAMENTO DE DADOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ANTES (PROBLEMA)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Admin A     â”‚                    â”‚  Admin B     â”‚              â”‚
â”‚  â”‚ Academia X   â”‚                    â”‚ Academia Y   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                   â”‚                       â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                         â”‚                                           â”‚
â”‚                         â–¼                                           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚    BANCO DE DADOS (users)     â”‚                          â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚         â”‚ â€¢ Nutricionista N1 (Admin A)  â”‚ â—„â”€â”€ Admin B vÃª isso! âŒ  â”‚
â”‚         â”‚ â€¢ Personal P1 (Admin A)       â”‚ â—„â”€â”€ Admin B vÃª isso! âŒ  â”‚
â”‚         â”‚ â€¢ Aluno A1 (Admin A)          â”‚ â—„â”€â”€ Admin B vÃª isso! âŒ  â”‚
â”‚         â”‚ â€¢ Nutricionista N2 (Admin B)  â”‚ â—„â”€â”€ Admin A vÃª isso! âŒ  â”‚
â”‚         â”‚ â€¢ Personal P2 (Admin B)       â”‚ â—„â”€â”€ Admin A vÃª isso! âŒ  â”‚
â”‚         â”‚ â€¢ Aluno A2 (Admin B)          â”‚ â—„â”€â”€ Admin A vÃª isso! âŒ  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                      â”‚
â”‚  âš ï¸  PROBLEMA: Todos os admins veem TODOS os usuÃ¡rios!             â”‚
â”‚  âš ï¸  ViolaÃ§Ã£o de privacidade e LGPD!                               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DEPOIS (SOLUÃ‡ÃƒO)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Admin A     â”‚                    â”‚  Admin B     â”‚              â”‚
â”‚  â”‚ Academia X   â”‚                    â”‚ Academia Y   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                                   â”‚                       â”‚
â”‚         â”‚                                   â”‚                       â”‚
â”‚         â–¼                                   â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ RLS FILTER      â”‚            â”‚ RLS FILTER      â”‚               â”‚
â”‚  â”‚ created_by =    â”‚            â”‚ created_by =    â”‚               â”‚
â”‚  â”‚ Admin A         â”‚            â”‚ Admin B         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                              â”‚                         â”‚
â”‚           â–¼                              â–¼                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ VISÃƒO Admin A   â”‚            â”‚ VISÃƒO Admin B   â”‚               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚  â”‚ â€¢ N1 âœ…         â”‚            â”‚ â€¢ N2 âœ…         â”‚               â”‚
â”‚  â”‚ â€¢ P1 âœ…         â”‚            â”‚ â€¢ P2 âœ…         â”‚               â”‚
â”‚  â”‚ â€¢ A1 âœ…         â”‚            â”‚ â€¢ A2 âœ…         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                      â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚         â”‚    BANCO DE DADOS (users)     â”‚                          â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚         â”‚ id  â”‚ name â”‚ created_by_admin â”‚                          â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚         â”‚ N1  â”‚ ...  â”‚ Admin A          â”‚                          â”‚
â”‚         â”‚ P1  â”‚ ...  â”‚ Admin A          â”‚                          â”‚
â”‚         â”‚ A1  â”‚ ...  â”‚ Admin A          â”‚                          â”‚
â”‚         â”‚ N2  â”‚ ...  â”‚ Admin B          â”‚                          â”‚
â”‚         â”‚ P2  â”‚ ...  â”‚ Admin B          â”‚                          â”‚
â”‚         â”‚ A2  â”‚ ...  â”‚ Admin B          â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                      â”‚
â”‚  âœ… SOLUÃ‡ÃƒO: Cada admin vÃª APENAS seus usuÃ¡rios!                   â”‚
â”‚  âœ… Privacidade garantida!                                         â”‚
â”‚  âœ… Conformidade com LGPD!                                         â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FLUXO DE CRIAÃ‡ÃƒO DE USUÃRIO                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. Admin A faz login                                               â”‚
â”‚     â†“                                                                â”‚
â”‚  2. Admin A clica em "Novo UsuÃ¡rio"                                 â”‚
â”‚     â†“                                                                â”‚
â”‚  3. Preenche dados do Nutricionista N1                              â”‚
â”‚     â†“                                                                â”‚
â”‚  4. Flutter envia para Supabase:                                    â”‚
â”‚     {                                                                â”‚
â”‚       name: "N1",                                                   â”‚
â”‚       email: "n1@email.com",                                        â”‚
â”‚       role: "nutritionist",                                         â”‚
â”‚       created_by_admin_id: "ID_ADMIN_A"  â—„â”€â”€ IMPORTANTE!           â”‚
â”‚     }                                                                â”‚
â”‚     â†“                                                                â”‚
â”‚  5. Trigger do Supabase valida e garante:                           â”‚
â”‚     - created_by_admin_id = auth.uid() (Admin A)                    â”‚
â”‚     â†“                                                                â”‚
â”‚  6. RLS valida:                                                      â”‚
â”‚     - Admin A tem permissÃ£o? âœ… SIM                                 â”‚
â”‚     - created_by_admin_id = Admin A? âœ… SIM                         â”‚
â”‚     â†“                                                                â”‚
â”‚  7. UsuÃ¡rio N1 criado com sucesso!                                  â”‚
â”‚     - N1 pertence ao Admin A                                        â”‚
â”‚     - Apenas Admin A pode ver/editar/excluir N1                     â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TENTATIVA DE ACESSO INDEVIDO                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1. Admin B faz login                                               â”‚
â”‚     â†“                                                                â”‚
â”‚  2. Admin B tenta listar todos os usuÃ¡rios                          â”‚
â”‚     SELECT * FROM users                                             â”‚
â”‚     â†“                                                                â”‚
â”‚  3. RLS intercepta e modifica a query:                              â”‚
â”‚     SELECT * FROM users                                             â”‚
â”‚     WHERE created_by_admin_id = 'ID_ADMIN_B'  â—„â”€â”€ AutomÃ¡tico!      â”‚
â”‚     â†“                                                                â”‚
â”‚  4. Resultado:                                                       â”‚
â”‚     - N2 âœ… (criado por Admin B)                                    â”‚
â”‚     - P2 âœ… (criado por Admin B)                                    â”‚
â”‚     - A2 âœ… (criado por Admin B)                                    â”‚
â”‚     - N1 âŒ (criado por Admin A - BLOQUEADO)                        â”‚
â”‚     - P1 âŒ (criado por Admin A - BLOQUEADO)                        â”‚
â”‚     - A1 âŒ (criado por Admin A - BLOQUEADO)                        â”‚
â”‚     â†“                                                                â”‚
â”‚  5. Admin B vÃª apenas seus prÃ³prios usuÃ¡rios! âœ…                    â”‚
â”‚                                                                      â”‚
â”‚  âš ï¸  Mesmo que o app Flutter tenha bugs, o banco protege!          â”‚
â”‚  âš ï¸  ImpossÃ­vel burlar via API direta!                             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ESTRUTURA DA TABELA USERS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  CREATE TABLE public.users (                                        â”‚
â”‚    id                    UUID PRIMARY KEY,                          â”‚
â”‚    name                  TEXT NOT NULL,                             â”‚
â”‚    email                 TEXT UNIQUE NOT NULL,                      â”‚
â”‚    phone                 TEXT,                                      â”‚
â”‚    role                  TEXT NOT NULL,                             â”‚
â”‚    created_by_admin_id   UUID REFERENCES auth.users(id), â—„â”€â”€ NOVO! â”‚
â”‚    created_at            TIMESTAMP DEFAULT NOW(),                   â”‚
â”‚    ...                                                               â”‚
â”‚  );                                                                  â”‚
â”‚                                                                      â”‚
â”‚  ÃNDICE para performance:                                           â”‚
â”‚  CREATE INDEX idx_users_created_by_admin                            â”‚
â”‚    ON public.users(created_by_admin_id);                            â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    POLÃTICAS RLS (4 POLÃTICAS)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  1ï¸âƒ£  SELECT (VisualizaÃ§Ã£o)                                         â”‚
â”‚     â†’ Admin vÃª apenas usuÃ¡rios que criou                            â”‚
â”‚     â†’ UsuÃ¡rio vÃª seus prÃ³prios dados                                â”‚
â”‚     â†’ Nutricionista vÃª seus alunos                                  â”‚
â”‚     â†’ Trainer vÃª seus alunos                                        â”‚
â”‚                                                                      â”‚
â”‚  2ï¸âƒ£  INSERT (CriaÃ§Ã£o)                                               â”‚
â”‚     â†’ Apenas admins podem criar usuÃ¡rios                            â”‚
â”‚     â†’ created_by_admin_id deve ser o ID do admin atual              â”‚
â”‚                                                                      â”‚
â”‚  3ï¸âƒ£  UPDATE (AtualizaÃ§Ã£o)                                           â”‚
â”‚     â†’ Admin pode atualizar apenas seus usuÃ¡rios                     â”‚
â”‚     â†’ UsuÃ¡rio pode atualizar seus prÃ³prios dados                    â”‚
â”‚                                                                      â”‚
â”‚  4ï¸âƒ£  DELETE (ExclusÃ£o)                                              â”‚
â”‚     â†’ Admin pode deletar apenas seus usuÃ¡rios                       â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CASOS ESPECIAIS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  ğŸ”¹ CASO 1: Novo Admin se Registra                                  â”‚
â”‚     - created_by_admin_id = seu prÃ³prio ID                          â”‚
â”‚     - Admin Ã© "criador" de si mesmo                                 â”‚
â”‚     - Trigger garante isso automaticamente                          â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”¹ CASO 2: Admin cria Nutricionista                                â”‚
â”‚     - created_by_admin_id = ID do admin                             â”‚
â”‚     - Nutricionista pertence ao admin                               â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”¹ CASO 3: Admin cria Personal                                     â”‚
â”‚     - created_by_admin_id = ID do admin                             â”‚
â”‚     - Personal pertence ao admin                                    â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”¹ CASO 4: Admin cria Aluno                                        â”‚
â”‚     - created_by_admin_id = ID do admin                             â”‚
â”‚     - Aluno pertence ao admin                                       â”‚
â”‚     - Nutricionista/Trainer do mesmo admin pode ver o aluno         â”‚
â”‚                                                                      â”‚
â”‚  ğŸ”¹ CASO 5: UsuÃ¡rios Ã“rfÃ£os (migraÃ§Ã£o)                              â”‚
â”‚     - Script atribui ao primeiro admin                              â”‚
â”‚     - Ou cria admin "sistema" para gerenciar                        â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š EXEMPLO PRÃTICO

### **CenÃ¡rio: 2 Academias**

**Academia X (Admin A):**
- Admin: admin_x@academia.com
- Nutricionista: nutri_x@academia.com
- Personal: personal_x@academia.com
- Alunos: aluno1_x@academia.com, aluno2_x@academia.com

**Academia Y (Admin B):**
- Admin: admin_y@academia.com
- Nutricionista: nutri_y@academia.com
- Personal: personal_y@academia.com
- Alunos: aluno1_y@academia.com, aluno2_y@academia.com

### **Tabela users no banco:**

| id | name | email | role | created_by_admin_id |
|----|------|-------|------|---------------------|
| A1 | Admin X | admin_x@... | admin | A1 (si mesmo) |
| A2 | Admin Y | admin_y@... | admin | A2 (si mesmo) |
| N1 | Nutri X | nutri_x@... | nutritionist | A1 |
| N2 | Nutri Y | nutri_y@... | nutritionist | A2 |
| P1 | Personal X | personal_x@... | trainer | A1 |
| P2 | Personal Y | personal_y@... | trainer | A2 |
| S1 | Aluno 1 X | aluno1_x@... | student | A1 |
| S2 | Aluno 2 X | aluno2_x@... | student | A1 |
| S3 | Aluno 1 Y | aluno1_y@... | student | A2 |
| S4 | Aluno 2 Y | aluno2_y@... | student | A2 |

### **Quando Admin X faz login:**

```sql
-- Query que o Flutter faz:
SELECT * FROM users;

-- O que o RLS transforma:
SELECT * FROM users WHERE created_by_admin_id = 'A1';

-- Resultado:
-- A1, N1, P1, S1, S2 âœ…
-- (NÃƒO vÃª: A2, N2, P2, S3, S4) âŒ
```

### **Quando Admin Y faz login:**

```sql
-- Query que o Flutter faz:
SELECT * FROM users;

-- O que o RLS transforma:
SELECT * FROM users WHERE created_by_admin_id = 'A2';

-- Resultado:
-- A2, N2, P2, S3, S4 âœ…
-- (NÃƒO vÃª: A1, N1, P1, S1, S2) âŒ
```

---

## ğŸ¯ BENEFÃCIOS

âœ… **Privacidade:** Dados de uma academia nÃ£o vazam para outra  
âœ… **SeguranÃ§a:** ProteÃ§Ã£o no nÃ­vel do banco de dados  
âœ… **Escalabilidade:** Suporta infinitas academias  
âœ… **LGPD:** Conformidade com lei de proteÃ§Ã£o de dados  
âœ… **Simplicidade:** Transparente para o desenvolvedor  
âœ… **Performance:** Ãndices otimizam consultas  

---

**Criado em:** 2026-01-17  
**VersÃ£o:** 1.0
